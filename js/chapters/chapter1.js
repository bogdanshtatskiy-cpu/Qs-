/* ГЛАВА 1: ПОБЕГ
   Файл: js/chapters/chapter1.js
*/

Object.assign(Game.scenes, {
    
    "ch1_start": {
        text: "Дверь распахивается. На пороге стоит человек в красной мантии — культист Алого Пакта. Его лицо скрыто капюшоном, в руке окровавленный кинжал.\n\nОн видит тебя и делает выпад!",
        choices: [
            { text: "Выбить кинжал (Сила 6)", req: {stat: "strength", val: 6}, next: "ch1_fight_win", fallback: "ch1_fight_fail" },
            { text: "Уклониться (Ловкость 6)", req: {stat: "agility", val: 6}, next: "ch1_fight_dodge", fallback: "ch1_fight_fail" },
            { text: "Отпрыгнуть назад", next: "ch1_retreat" }
        ]
    },

    "ch1_fight_win": {
        text: "Ты перехватываешь его руку и с силой ударяешь о косяк двери. Культист воет от боли и роняет оружие. Ты толкаешь его в коридор, и он падает.",
        actions: [{type: "addItem", item: "Кривой кинжал"}],
        choices: [
            { text: "Выбежать в коридор", next: "ch1_corridor" }
        ]
    },

    "ch1_fight_dodge": {
        text: "Ты ныряешь под лезвие. Культист теряет равновесие. Ты пинаешь его в спину, и он падает, теряя сознание.",
        actions: [{type: "addItem", item: "Кривой кинжал"}],
        choices: [
            { text: "Забрать кинжал и выйти", next: "ch1_corridor" }
        ]
    },

    "ch1_fight_fail": {
        text: "Тюремная слабость дает о себе знать. Ты не успеваешь среагировать. Лезвие вспарывает тебе плечо.\n<span style='color:#c0392b'>Получено 15 урона.</span>\n\nК счастью, в коридоре раздается взрыв, и культист убегает в панике.",
        actions: [{type: "damage", val: 15}],
        choices: [
            { text: "Зажать рану и выйти", next: "ch1_corridor" }
        ]
    },

    "ch1_retreat": {
        text: "Ты отступаешь. Культист уже готов нанести второй удар, но вдруг падает замертво. Из его спины торчит арбалетный болт.",
        choices: [
            { text: "Осторожно выглянуть", next: "ch1_corridor" }
        ]
    },

    "ch1_corridor": {
        text: "Тюрьма в огне. Заключенные бегут, стражники сражаются с культистами. Хаос.\nТы видишь раненого стражника, ползущего по полу. Он тянет к тебе руку: 'Помоги...'",
        choices: [
            { text: "Добить его и забрать меч (Жестокость)", next: "ch1_kill_guard" },
            { text: "Помочь ему (Милосердие)", next: "ch1_help_guard" },
            { text: "Пройти мимо", next: "ch1_ignore_guard" }
        ]
    },

    "ch1_kill_guard": {
        text: "Ты решаешь, что его мучения пора закончить. Ты забираешь его меч.\n<span style='color:#c0392b'>Репутация с Империей понижена.</span>",
        actions: [{type: "addItem", item: "Имперский меч"}, {type: "rep", faction: "Империя", val: -10}],
        choices: [
            { text: "Идти к выходу", next: "ch1_exit" }
        ]
    },

    "ch1_help_guard": {
        text: "Ты перевязываешь его рану обрывком рубахи. Стражник шепчет: 'Спасибо... Возьми этот ключ, он от канализации. Там безопасно'.",
        actions: [{type: "addItem", item: "Ключ от стоков"}, {type: "rep", faction: "Империя", val: 5}],
        choices: [
            { text: "Взять ключ и уйти", next: "ch1_sewer_enter" }
        ]
    },

    "ch1_ignore_guard": {
        text: "Не твоя война. Ты проходишь мимо, оставляя его умирать.",
        choices: [
            { text: "Идти к главному выходу", next: "ch1_exit" }
        ]
    },

    "ch1_exit": {
        text: "Главный выход завален горящими балками. Пути нет. Ты слышишь приближение отряда культистов.",
        choices: [
            { text: "Искать другой путь (Интеллект 4)", req: {stat: "intellect", val: 4}, next: "ch1_find_sewer", fallback: "ch1_captured" }
        ]
    },

    "ch1_find_sewer": {
        text: "Ты замечаешь люк в полу, прикрытый соломой. Это шанс!",
        choices: [
            { text: "Спуститься вниз", next: "ch1_sewer_enter" }
        ]
    },

    "ch1_captured": {
        text: "Ты мечешься в панике, но выхода нет. Культисты окружают тебя. Удар по голове погружает тебя во тьму...\n\n(Это плохая концовка, но история позволяет тебе попробовать снова)",
        choices: [
            { text: "Очнуться (Загрузить начало боя)", next: "ch1_start" }
        ]
    },

    "ch1_sewer_enter": {
        text: "Ты спрыгиваешь в темные, вонючие стоки Ривергарда. Шум битвы стихает наверху. Ты свободен... пока что.\n\nВпереди тебя ждет долгий путь через подземелья к лагерю Мятежников.",
        choices: [
            // ЗДЕСЬ ИДЕТ ПЕРЕХОД НА ГЛАВУ 2
            // Если файла chapter2.js нет, движок покажет экран "В разработке"
            { text: "Идти вглубь тоннеля (Глава 2)", next: "ch2_start" } 
        ]
    }

});
